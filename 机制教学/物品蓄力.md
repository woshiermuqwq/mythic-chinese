情景
------
现有一个物品供玩家使用, 此物品功能有:
- 右键后开始蓄力
- 蓄力状态下不断增加蓄力进度
- 蓄力状态下右键后取消蓄力
- 左键后发射火球（需蓄力进度 ≥ 33%）
- 火球的攻击段数、最大移动距离、球体特效半径受 蓄力阶段影响, 蓄力阶段又被 蓄力进度影响 共3段
- 蓄力完成后可继续蓄力, 但不会增加蓄力进度
火球技能
单击右键开始蓄力
再次摁下右键取消蓄力
技能共分三个阶段
「蓄力33/66/100%」
火球的距离 范围 伤害段数随阶段数递增
单击左键结束蓄力 释放火球技能
- 本教程所用机制占比：[占位符](/技能/占位符) 100%

[![](https://s20.directupload.net/images/210824/69h2je2m.gif)]

原理 （无载体）
------

前置 Crucible 因要做到左右键  
蓄力读数（增加蓄力进度）使用 [占位符](/技能/占位符)） （与计时器做法差不多）  
蓄力阶段对抛射物的影响需要使用重复激活来做到（重复激活的值支持 [占位符](/技能/占位符)）  
蓄力提示涉及到 2个 [占位符](/技能/占位符)） 


涉及技能 / 条件
------

- [Skill](/技能/列表/skill)
- [Set Variable](/技能/列表/setvariable)
- [Send Title Message](/技能/列表/sendtitlemessage)
- [Variable In Range](/条件/variableinrange)

步骤1: 右键后开始蓄力
------

首先是物品配置叭..用到了[触发器: ~onUse](/技能/触发器)(右键后激活)

### 物品配置

    蓄力物品:
      Id: iron_sword
      Display: '可蓄力物品'
      Skills:
      - skill:蓄力 @self ~onUse

### 技能组配置

    蓄力:
      Conditions:
      - variableinrange{var=caster.蓄力开关;v=1} false
      Cooldown: 0.1
      Skills:
      - setvariable{var=caster.蓄力阶段提示;type=float;value="0"} @self
      - setvariable{var=caster.蓄力进度;type=float;value="0"} @self
      - setvariable{var=caster.蓄力开关;type=float;value="0"} @self
      - setvariable{var=caster.蓄力开关;type=float;value="<caster.var.蓄力开关> + 0.5";repeat=1;repeatInterval=1} @self

技能组: 蓄力 对自身的要求为: 自身身上的变量: 蓄力开关的值 ≠ 1  
技能组: 蓄力的内容为  
设置自身身上的变量: 蓄力阶段提示 值为 0  
设置自身身上的变量: 蓄力进度 值为 0  
设置自身身上的变量: 蓄力开关 值为 0  
重复激活俩次，激活间隔1tick, 设置自身身上的变量: 蓄力开关 值为 自身身上蓄力开关的值 - 0.5  
 
为啥变量: 蓄力开关 涉及到俩行Setvariable, 甚至重复激活? 将在下一步的时候解释

这样 玩家右键物品后 这四行 Setvariable 就相当于将整个机制用到的 所有变量 设为 默认值

步骤2: 蓄力状态下不断增加蓄力进度
-------------

物品配置叭..用到了[触发器: ~onTimer:](/技能/触发器)(右键后激活)

### 物品配置

    蓄力物品:
      Id: iron_sword
      Display: '可蓄力物品'
      Skills:
      - skill:蓄力 @self ~onUse
      - skill:蓄力读数 @self ~onTimer:1

每1tick 激活技能组: 蓄力读数（用于不断加值）

### 技能组配置

    蓄力读数:
      Conditions:
      - variableinrange{var=caster.蓄力开关;v=1}
      Skills:
      - setvariable{var=caster.蓄力进度;type=float;value="<caster.var.蓄力进度> + 0.05"} @self

技能组：蓄力读数 对自身的要求为: "自身身上的变量: 蓄力开关 的值为 1（注意步骤1的描述 相当于开始蓄力）"  
技能组：蓄力读数的内容为: "设置自身身上的变量: 蓄力进度 值为 自身身上的变量: 蓄力进度的值 + 0.05"  
1tick + 0.05, 20tick + 1（也就是+1蓄力进度/秒）

步骤3: 蓄力状态下右键后取消蓄力
-------------

### 物品配置

    蓄力物品:
      Id: iron_sword
      Display: '可蓄力物品'
      Skills:
      - skill:蓄力 @self ~onUse
      - skill:蓄力读数 @self ~onTimer:1
      - skill:蓄力取消 @self ~onUse

与上文差异在, 右键可激活第二个技能组：取消蓄力

### 技能组配置

    蓄力取消:
      Conditions:
      - variableinrange{var=caster.蓄力开关;v=1}
      - variableinrange{var=caster.蓄力进度;v=<30}
      Skills:
      - sendtitle{title="&c蓄力取消";subtitle="请勿再次右键";d=40} @self
      - setvariable{var=caster.蓄力开关;type=float;value="<caster.var.蓄力开关> - 0.5";repeat=1;repeatInterval=1} @self
      - setvariable{var=caster.蓄力进度;type=float;value="0"} @self
      - setvariable{var=caster.蓄力阶段提示;type=float;value="0"} @self

技能组：蓄力读数 对自身的要求为:  
自身身上的变量: 蓄力开关 的值为 1（相当于正在进行蓄力）

技能组: 蓄力 对自身的要求为: 自身身上的变量: 蓄力开关的值 ≠ 1  
技能组: 蓄力的内容为  
设置自身身上的变量: 蓄力进度 值为 0  
设置自身身上的变量: 蓄力开关 值为 0  
重复激活俩次，激活间隔1tick, 设置自身身上的变量: 蓄力开关 值为 自身身上蓄力开关的值 - 0.5  

这样 玩家右键物品后再次右键 这三行 Setvariable 就相当于将整个机制用到的 3个变量（还有1个是自动计算的） 设为 默认值

为啥变量: 蓄力开关 涉及到俩行Setvariable 且重复激活， 与步骤1一样？只是加值变成了减值?  
因为这里的重复激活相当于一个蓄力预热（也可以理解为前摇）  
重复激活俩次，每次给变量的值加上0.5  
步骤1: 右键后开始蓄力 , 右键后首先将变量: 蓄力开关 值设为 0 随后进行预热(也就是重复激活)  
预热结束后, 蓄力开关值为 1  
步骤3: 开始蓄力后右键取消蓄力 , 右键后首先将变量: 蓄力开关 值设为 0 随后进行预热(也就是重复激活)  
预热结束后, 蓄力开关值为 0  
因 步骤1 技能组条件为 变量: 蓄力开关的值不等于 1  
而 步骤3 技能组条件为 变量: 蓄力开关的值等于 1  
这就意味着, 当变量: 蓄力开关值在0到1之间时（也就是"蓄力预热"）  
只有技能组：(开始)蓄力 可以激活（技能组：蓄力取消不是把 蓄力开关 的值设为0么？ 减了俩次0.5变-1啦 不符合取消蓄力的条件）  
若 步骤3 技能组条件变更为变量: 蓄力开关的值等于 0 , 预热就跟没有一样  
若 这俩步骤 设置变量: 蓄力开关 时没有重复（设置后的值直接为1 步骤3则为0）, 就会导致右键后开始的一瞬间取消掉蓄力.