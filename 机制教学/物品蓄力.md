情景
------
现有一个物品供玩家使用, 此物品功能有:
- 右键后开始蓄力（蓄力完成需30秒）
- 蓄力状态下不断增加蓄力进度（需未完全蓄力）
- 蓄力状态下右键后取消蓄力（需未完全蓄力）
- 左键后发射火球（需已完成蓄力第一阶段）
- 火球的攻击段数、最大移动距离、球体特效半径受 蓄力阶段影响（每完成一阶段蓄力, 就额外造成1次伤害 特效半径额外扩大1格方块）
- 切换手持物品后取消蓄力
- 本教程所用机制占比：[占位符](/技能/占位符) 100%

[![](https://s20.directupload.net/images/210824/69h2je2m.gif)]

原理 （无载体）
------

前置 Crucible 因要做到左右键  
蓄力读数（增加蓄力进度）使用 [占位符](/技能/占位符) （与计时器做法差不多）  
蓄力阶段对抛射物的影响需要使用重复激活来做到（重复激活的值支持 [占位符](/技能/占位符)）  
蓄力提示涉及到 2个 [占位符](/技能/占位符)） 

注意
------

**此教程用到的所有[占位符(包括变量)](/技能/占位符)全都位于施法者身上, 下文将忽略**

涉及技能 / 条件
------

- [Skill](/技能/列表/skill)
- [Set Variable](/技能/列表/setvariable)
- [Send Title Message](/技能/列表/sendtitlemessage)
- [Variable In Range](/条件/variableinrange)

步骤1: 右键后开始蓄力
------

首先是物品配置叭..用到了[触发器: ~onUse](/技能/触发器)(右键后激活)

### 物品配置

    蓄力物品:
      Id: iron_sword
      Display: '可蓄力物品'
      Skills:
      - skill:蓄力 @self ~onUse

### 技能组配置

    蓄力:
      Conditions:
      - variableinrange{var=caster.蓄力开关;v=0.1to1} false
      Cooldown: 0.1
      Skills:
      - setvariable{var=caster.蓄力阶段提示;type=float;value="0"} @self
      - setvariable{var=caster.蓄力进度;type=float;value="0"} @self
      - setvariable{var=caster.蓄力开关;type=float;value="0"} @self
      - setvariable{var=caster.蓄力开关;type=float;value="<caster.var.蓄力开关> + 0.5";repeat=1;repeatInterval=1} @self

技能组: 蓄力 对自身的要求为: 位于自身的变量: 蓄力开关的值 小于0.1或大于1 
技能组: 蓄力的内容为  
  设置变量: 蓄力阶段提示 值为 0  
  设置变量: 蓄力进度 值为 0  
  设置变量: 蓄力开关 值为 0  
  重复2次设置变量: 蓄力开关 值为 位于自身蓄力开关的值 - 0.5  
 
为啥变量: 蓄力开关 涉及到俩行Setvariable, 甚至重复激活? 将在下一步的时候解释

这样 玩家右键物品后 这四行 Setvariable 就相当于将整个机制用到的 所有变量 设为 默认值

步骤2: 蓄力状态下不断增加蓄力进度
-------------

物品配置叭..用到了[触发器: ~onTimer:](/技能/触发器)(右键后激活)

### 物品配置

    蓄力物品:
      Id: iron_sword
      Display: '可蓄力物品'
      Skills:
      - skill:蓄力 @self ~onUse
      - skill:蓄力读数 @self ~onTimer:1

每1tick 激活技能组: 蓄力读数（用于不断加值）

### 技能组配置

    蓄力读数:
      Conditions:
      - variableinrange{var=caster.蓄力开关;v=>0.1}
      Skills:
      - setvariable{var=caster.蓄力进度;type=float;value="<caster.var.蓄力进度> + 0.05"} @self

技能组：蓄力读数 对自身的要求为: "变量: 蓄力开关 的值大于 0.1（注意步骤1的描述 相当于蓄力中）"  
技能组：蓄力读数的内容为:  
设置变量: 蓄力进度 值为 蓄力进度的值 + 0.05"  
1tick + 0.05, 20tick + 1（也就是+1蓄力进度/秒）

步骤3: 蓄力状态下右键后取消蓄力
-------------

### 物品配置

    蓄力物品:
      Id: iron_sword
      Display: '可蓄力物品'
      Skills:
      - skill:蓄力 @self ~onUse
      - skill:蓄力读数 @self ~onTimer:1
      - skill:蓄力取消 @self ~onUse

与上文差异在, 右键可激活第二个技能组：取消蓄力

### 技能组配置

    蓄力取消:
      Conditions:
      - variableinrange{var=caster.蓄力开关;v=>0.1}
      - variableinrange{var=caster.蓄力进度;v=>0}
      Skills:
      - sendtitle{title="&c蓄力取消";subtitle="请勿再次右键";d=40} @self
      - setvariable{var=caster.蓄力开关;type=float;value="<caster.var.蓄力开关> - 0.5";repeat=1;repeatInterval=1} @self
      - setvariable{var=caster.蓄力进度;type=float;value="0"} @self
      - setvariable{var=caster.蓄力阶段提示;type=float;value="0"} @self

技能组：蓄力读数 对自身的要求为:  
变量: 蓄力开关 的值大于 0.1（相当于蓄力中）

技能组: 蓄力 对自身的要求为: 变量: 蓄力开关的值 ≠ 1  
技能组: 蓄力的内容为  
  设置的变量: 蓄力进度 值为 0  
  设置的变量: 蓄力开关 值为 0  
  重复激活俩次，激活间隔1tick, 设置变量: 蓄力开关 值为 蓄力开关当前值 - 0.5  

这样 玩家右键物品后再次右键 这三行 Setvariable 就相当于将整个机制用到的 3个变量（还有1个是自动计算的） 设为 默认值

为啥变量: 蓄力开关 涉及到俩行Setvariable 且重复激活， 与步骤1一样？只是加值变成了减值?  
因为这里的重复激活相当于一个蓄力预热（也可以理解为前摇）  

步骤1: 右键后开始蓄力 , 右键后首先将变量: 蓄力开关 值设为 0 随后进行预热(也就是重复激活)  
       预热结束后, 蓄力开关值为 1(先被设为0, 再连续2次+0.5)  
步骤3: 开始蓄力后右键取消蓄力 , 右键后首先将变量: 蓄力开关 值设为 0 随后进行预热(也就是重复激活)  
       预热结束后, 蓄力开关值为 -1(先被设为0, 再连续2次-0.5)  

因 步骤1 技能组条件为 变量: 蓄力开关的值不等于 1  
而 步骤3 技能组条件为 变量: 蓄力开关的值等于 1  
这就意味着, 当变量: 蓄力开关值在0到1之间时（也就是"蓄力预热"）  
只有技能组：(开始)蓄力 可以激活（技能组：蓄力取消后 蓄力开关的值变为-1 不符合取消蓄力的条件）  

若 步骤3 技能组条件变更为变量: 蓄力开关的值等于 0 , 预热就跟没有一样  
若 这俩步骤 设置变量: 蓄力开关 时没有重复（设置后的值直接为1 步骤3则为0）, 就会导致右键后开始蓄力了又给你取消掉

步骤4: 左键后发射火球（需已完成蓄力第一阶段）
-------------------

### 物品配置

    蓄力物品:
      Id: iron_sword
      Display: '可蓄力物品'
      Skills:
      - skill:蓄力 @self ~onUse
      - skill:蓄力读数 @self ~onTimer:1
      - skill:蓄力取消 @self ~onUse
      - skill:蓄力释放 @self ~onSwing

新增技能行: 左键可激活技能组：蓄力释放

### 技能组配置

    蓄力释放:
      Conditions:
      - variableinrange{var=caster.蓄力进度;v=>10}
      - variableinrange{var=caster.蓄力开关;v=>0.1}
      Skills:
      - setvariable{var=target.受伤间隔;type=float;value="0"} @EIR{r=16}
      - sendtitle{title="&a激活技能";subtitle="OwOb";d=40} @self
      - setvariable{var=caster.蓄力开关;type=float;value="0"} @self
      - setvariable{var=caster.蓄力开关;type=float;value="<caster.var.蓄力开关> - 0.5";repeat=1;repeatInterval=1} @self
      - projectile{ot=蓄力释放-Tick;oe=蓄力释放-End;se=false;sb=false;hnp=true;md=100;v=4;i=1} @forward{f=2000}

技能组: 蓄力释放 对自身的要求为:  
  变量: 蓄力进度的值 > 10（蓄力完成需要30秒，>10相当于已完成蓄力第一阶段）  
  变量：蓄力开关的值 > 0.1（相当于蓄力中）
技能组: 蓄力释放 的内容为:  
  设置位于"16格方块半径范围内的所有实体"身上的变量: 受伤间隔 值为 0（因这个火球不会在命中实体后消失，若不这么做将造成多次伤害）  
  提示就不用说了..  
  设置位于自身身上的变量: 蓄力开关 值为 0  
  重复2次设置位于自身身上的变量: 蓄力开关 值为 蓄力开关的值(位于自身) - 0.5 （最终值为-1）  
